---
title: SQL#02//sql 큰 그림을 그려보자
date: 2020-02-11 22:02:36
layout: post
draft: false
path: "/cs/db-sql/sql-02/"
category: "DB&SQL"
tags:
- "sql"
description: "SQL을 짜는 전략에 대해서 알아봅시다."
---
지난 포스트에서 설명한 것을 제목만 나열해 보겠습니다.

#### 1. 추출하고자 하는 데이터를 설정한다.
#### 2. 조건이 있다면 조건을 정리하고, 계산을 해야하는 데이터를 구분한다.
#### 3. 데이터 추출을 위해 테이블 간에 관계가 필요하다면 어떤 관게로 이루어 져야 할지 정리한다.

---

큰 흐름은 이렇습니다. 1번과 2번은 [지난 포스트](https://bmh8993.github.io/DATABASE&SQL/sql-%EC%A7%9C%EA%B8%B0-%EC%A0%84%EC%97%90-%ED%9D%90%EB%A6%84%EC%9D%84-%ED%8C%8C%EC%95%85%ED%95%98%EC%9E%90./)에서 예시로 정리를 했으니 넘어가도록 하겠습니다.<br><br>
먼저 추출하고자 하는 데이터와 조건들을 살펴보겠습니다.<br>

- **가져오고자 하는 데이터**
    1. 순위
    2. 순위 변동(기준일자와 기준일자의 하루 전데이터의 비교)
    3. 회사 이름
    4. 누적 대출액
    5. 기타 데이터

- **조건**
    1. is\_use = True
    2. `누적 대출액`을 기준으로 내림차순 정렬을 진행합니다.
    3. is\_association의 값이 `True` or `False` 혹은 `True와 False 모두` 이렇게 첫번째 필터 조건이 있습니다.
    4. 기준 일자를 설정합니다.
    5. 기타 컬럼들로 정렬이 가능해야합니다.

---
정리한 내용을 가지고 하나씩 살펴보겠습니다.<br>
5번 조건을 잠시 제외하고 생각하겠습니다.<br>
`순위`는 `누적 대출액`을 기준으로 내림차순 정렬할 예정입니다. 순위는 없는 컬럼이므로 만들어야 할 것 같습니다.<br>
`순위 변동`이라는 데이터는 말 그대로 변동을 나타내기 때문에 **오늘과 어제**처럼 차이가 필요합니다.
여기서 중요한 것은 `어제와 오늘` 테이블 `두 개`가 필요하고, 두 개의 테이블은 관계가 필요하다는 말이 됩니다.<br>
`회사이름`, `누적 대출액`, `기타 데이터`는 Item 테이블에서 가져올 수 있는 데이터 입니다.<br>

조건을 살펴보면 필터 조건이 있습니다. 그런데 문제가 있습니다.
`Header`테이블과 `Item`테이블은 서로 전혀 다른 데이터를 가지고 있습니다.
`Header`테이블은 조건을, `Item`테이블은 정보를 가지고 있습니다. 두 테이블의 연결고리는 `company_no`뿐입니다.

---
일단 이 이렇게 큰 그림을 그려보는 것이 중요합니다. 이 정리한 내용을 가지고 SQL을 작성해보겠습니다.
[다음 포스트](https://bmh8993.github.io/DATABASE&SQL/sql-%ED%81%B0-%EA%B7%B8%EB%A6%BC%EC%97%90%EC%84%9C-%EC%9E%91%EC%9D%80-%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C/)로 이어집니다.
